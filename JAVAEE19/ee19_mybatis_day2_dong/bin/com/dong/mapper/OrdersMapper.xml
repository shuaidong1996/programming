<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dong.mapper.OrdersMapper">
	<!-- 定义查询订单表列名的SQL片段 -->
	<sql id="orders_sql">
		orders.id,
		orders.user_id,
		orders.number,
		orders.createtime,
		orders.note
	</sql>
	<sql id="user_sql">
		user.username,
		user.address
	</sql>
	<sql id="orderdetail_sql">
		orderdetail.id detail_id,
		orderdetail.items_id,
		orderdetail.items_num 
	</sql>
	<!-- Orders 和  User 一对一映射 -->
	<resultMap type="com.dong.po.OrdersExt" id="OrdersUserRstMap">
		<!-- 映射订单信息（因为user_id和订单类的UserId名称不对应） -->
		<id column="id" property="id"/>
		<result column="user_id" property="userId"/>
		<result column="number" property="number"/>
		<result column="createtime" property="createtime"/>
		<result column="note" property="note"/>
		<!-- association 一对一映射(OrdersExt中包含一个User对象)
		property:关联信息查询的结果将要映射的扩展类中的对象“属性名称”
		javaType:指定关联对象所要映射的java类型
		id标签：建议在关联查询时必须写上，不写不会报错，但是会影响性能
		 -->
		<association property="user" javaType="com.dong.po.User">
			<id column="user_id" property="id"/>
			<result column="username" property="username"/>
			<result column="address" property="address"/>
		</association>
	</resultMap>
	<!-- 查询订单、用户表 -->
	<select id="findOrdersUser" resultMap="OrdersUserRstMap">
		select 
		<include refid="orders_sql"></include>
		,
		<include refid="user_sql"></include>
		from orders,user where orders.user_id = user.id
	</select>
	
	<!-- Orders User 和 Orderdetail 一对多映射 -->
	<!-- extends：可以继承一个已有的resultM, but, 只能继承type类型是一样的resultMap -->
	<resultMap type="com.dong.po.OrdersExt" id="OrdersUserOrderdetailRstMap" extends="OrdersUserRstMap">
		<!-- collection 一对多映射(OrdersExt中包含多个orderdetail对象) -->
		<collection property="orderdetailList" ofType="com.dong.po.Orderdetail">
			<id column="orders_id" property="id"/>
			<result column="id" property="ordersId"/>
			<result column="items_id" property="itemsId"/>
			<result column="items_num" property="itemsNum"/>
		</collection>
	</resultMap>
	<select id="findOrdersUserOrderdetail" resultMap="OrdersUserOrderdetailRstMap">
		select
		<include refid="orders_sql"></include>
		,
		<include refid="user_sql"></include>
		,
		<include refid="orderdetail_sql"></include>
		from orders,user,orderdetail 
		where orders.user_id = user.id and orders.id = orderdetail.orders_id
	</select>

</mapper>